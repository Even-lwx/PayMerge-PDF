# 📄 发票合并工具 v5.0 - 智能数据提取版

## 🎉 版本升级说明

**升级路径**: v3.0 (GUI基础版) → v4.0 (拖放版) → **v5.0 (智能数据提取版)**

v5.0 在保持 v4.0 所有拖放功能的基础上，新增了强大的智能数据处理能力！

## ✨ v5.0 新功能特性

### 🔍 智能发票数据提取
- **自动识别发票号码**: 支持多种发票号码格式
- **开票日期解析**: 智能识别各种日期格式
- **金额精确提取**: 自动提取价税合计金额
- **企业信息识别**: 自动提取销售方名称和纳税人识别号

### 📝 智能文件重命名
- **基于发票内容**: 根据提取的发票数据生成文件名
- **标准化格式**: `日期_销售方_金额_发票号后4位_已合并.pdf`
- **示例**: `20250926_某某科技_355.00元_#8467_已合并.pdf`

### 📊 CSV汇总记录功能
- **持续记录**: 自动生成并更新 `发票汇总记录.csv` 文件
- **完整信息**: 包含发票号、日期、金额、公司名称等完整数据
- **Excel兼容**: 支持直接用Excel打开进行数据分析

### 🎯 完全保持v4.0体验
- **拖放操作**: 继续支持拖放文件到界面
- **界面设计**: 保持友好的用户界面
- **操作流程**: 用户操作习惯完全一致

## 🚀 使用方法

### 方式一：直接运行Python脚本
```bash
python invoice_merger_v5.py
```

### 方式二：使用批处理文件
双击运行：`运行v5.bat`

### 方式三：启动脚本
双击运行：`启动v5智能版.bat`

## 📋 操作步骤

1. **启动程序**: 使用上述任一方式启动程序

2. **拖放文件**: 将以下文件拖放到程序界面
   - 1个PDF发票文件
   - 2张图片文件（购买记录 + 支付记录）

3. **自动提取**: 程序自动提取发票数据并在界面显示

4. **预览命名**: 查看智能生成的文件命名方案

5. **智能合并**: 点击【智能合并】按钮完成处理

6. **查看结果**: 
   - 获得智能命名的合并PDF文件
   - 发票信息自动记录到CSV汇总文件中

## 📊 输出文件说明

### 合并PDF文件
- **智能命名**: 基于发票内容自动生成文件名
- **格式**: `日期_销售方简称_金额_发票号后4位_已合并.pdf`
- **内容**: 包含发票、购买记录、支付记录的完整合并PDF

### CSV汇总记录
- **文件名**: `发票汇总记录.csv`
- **位置**: 程序所在目录
- **内容**: 
  - 发票号码
  - 开票日期  
  - 金额
  - 销售方名称
  - 纳税人识别号
  - 原文件名
  - 合并文件名
  - 处理时间

## 🛠️ 系统要求

### 运行环境
- **操作系统**: Windows 10/11
- **Python版本**: 3.9+ (如果使用源码运行)

### 依赖库
- **pypdfium2**: PDF文本提取
- **tkinterdnd2**: 拖放功能
- **PIL**: 图片处理
- **tkinter**: 用户界面 (Python内置)

### 安装依赖
```bash
pip install pypdfium2 tkinterdnd2 Pillow
```

## 🎯 智能命名示例

| 原文件名 | 提取数据 | 智能命名 |
|----------|----------|----------|
| 1开发板19.9.pdf | 日期:2025-09-18<br>公司:深圳某某电子<br>金额:19.90<br>发票号:...3789 | 20250918_深圳某某电子_19.90元_#3789_已合并.pdf |
| TC264学习板355.pdf | 日期:2025-09-23<br>公司:某某科技<br>金额:355.00<br>发票号:...8467 | 20250923_某某科技_355.00元_#8467_已合并.pdf |

## 🔧 功能特色

### 界面设计
- **分页显示**: 数据预览 + 文件命名预览
- **实时反馈**: 操作状态实时显示
- **友好提示**: 详细的使用说明和错误提示

### 技术特性
- **高质量PDF解析**: 基于pypdfium2专业库
- **智能模式匹配**: 多种正则表达式模式识别
- **后台处理**: 数据提取在后台线程进行，界面响应流畅
- **容错处理**: 即使数据提取失败也能正常合并文件

### 数据管理
- **持续汇总**: CSV文件持续累积发票记录
- **标准化存储**: UTF-8编码，Excel兼容
- **完整记录**: 保存处理时间和文件对应关系

## ❓ 常见问题

### Q: 程序启动失败怎么办？
A: 检查依赖库是否安装完整：`pip install pypdfium2 tkinterdnd2`

### Q: 数据提取不准确怎么办？
A: 程序会尝试多种模式匹配，如果提取失败会使用原文件名，不影响合并功能

### Q: CSV文件在哪里？
A: 在程序所在目录下的 `发票汇总记录.csv` 文件

### Q: 可以处理什么格式的文件？
A: 
- PDF格式的发票文件
- JPG/PNG格式的图片文件

## 🎉 版本对比

| 特性 | v3.0 | v4.0 | v5.0 |
|------|------|------|------|
| 基础合并 | ✅ | ✅ | ✅ |
| GUI界面 | ✅ | ✅ | ✅ |
| 拖放操作 | ❌ | ✅ | ✅ |
| 数据提取 | ❌ | ❌ | ✅ |
| 智能命名 | ❌ | ❌ | ✅ |
| CSV汇总 | ❌ | ❌ | ✅ |

## 📞 技术支持

如遇问题或需要功能建议，请检查：
1. 依赖库是否正确安装
2. 文件格式是否支持
3. 程序运行目录是否有写入权限

---

**🌟 v5.0 = v4.0拖放体验 + 智能数据处理 + 自动化管理**

享受智能化的发票处理体验！🎉