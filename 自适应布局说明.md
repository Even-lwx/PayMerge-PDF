# 智能自适应布局说明 v2.0 - 旋转优化版

## 🔍 自适应算法工作原理

### 1. 🆕 旋转优化算法

**新版本首先测试所有旋转可能性：**

```text
对于每张图片（发票、购买记录、支付记录）：
├── 原始方向 (0°)
└── 旋转方向 (90°)

总共测试组合：2³ = 8种可能
```

**智能旋转检测：**
- 📐 计算图片在指定区域内的缩放系数
- 🔄 比较原始方向 vs 旋转90°后的效果
- 🎯 选择缩放系数更大的方向（图片显示更大）

### 2. 增强布局方案评估

脚本会分析三张图片的尺寸比例，计算**16种布局+旋转方案**的空间利用率：

**方案1 - 水平布局（8种旋转组合）：**

```text
┌─────────────────────────┐
│       发票区域           │  ← 根据发票比例动态分配高度（最多70%）
│     (可能已旋转90°)      │
├─────────────┬───────────┤
│  购买记录   │  支付记录  │  ← 根据两图比例动态分配左右宽度
│ (可能旋转)  │ (可能旋转) │
└─────────────┴───────────┘
```

**方案2 - 垂直布局（8种旋转组合）：**

```text
┌─────────────┬───────────┐
│             │  购买记录  │
│   发票区域   │ (可能旋转) │
│ (可能已旋转) ├───────────┤  
│             │  支付记录  │
│             │ (可能旋转) │
└─────────────┴───────────┘
```

### 3. 🧮 算法评分机制

```python
# 对每种旋转+布局组合计算评分
for 发票旋转 in [False, True]:
    for 购买记录旋转 in [False, True]:
        for 支付记录旋转 in [False, True]:
            for 布局类型 in ['水平', '垂直']:
                评分 = 发票缩放系数 + 购买记录缩放系数 + 支付记录缩放系数
                
# 选择评分最高的组合
最优方案 = max(所有组合, key=评分函数)
```

### 4. 优化特性

✅ **智能旋转**：自动检测并应用最佳旋转角度
✅ **比例保持**：所有图片等比缩放，无变形
✅ **空间最大化**：通过旋转+布局组合，极大提升空间利用率  
✅ **视觉平衡**：保持适当间距，确保阅读体验
✅ **兼容性强**：支持各种尺寸的PDF和图片文件

## 🎨 适用场景升级

- **长条形发票** → 可能旋转为竖直方向，配合垂直布局
- **方形发票** → 智能选择最优旋转+布局组合
- **高瘦型记录图** → 可能旋转为横向，配合水平布局
- **宽扁型记录图** → 可能保持原状或旋转，视整体效果而定

**🎯 v2.0结果：通过智能旋转+自适应布局的双重优化，空间利用率显著提升！**